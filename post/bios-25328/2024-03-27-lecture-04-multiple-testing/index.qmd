---
title: "Multiple Testing"
author: "Haky Im"
date: "March 27, 2024"
format: 
  revealjs:
    self-contained: true
    slide-number: c/t
    width: 1600
    height: 900
    theme: simple
    echo: true
    transition: none
    center-title-slide: false
draft: true
---

```{r, eval=TRUE, fig.align='center'}
#| echo: false
FOLDER="/Users/haekyungim/Library/CloudStorage/Box-Box/LargeFiles/imlab-data/data-Github/web-data/images"
```

## The Perils of Multiple Testing

```{r, eval=TRUE, fig.align='center'}
#| echo: false
knitr::include_graphics(paste0(FOLDER,"/","2024-03-27-multiple-testing/multiple-testing-xkcd.com-882-I.png"))
```

::: notes
This xkcd cartoon illustrates the problem with multiple testing
:::

## The Perils of Multiple Testing (cont)

```{r, eval=TRUE, fig.align='center'}
#| echo: false
knitr::include_graphics(paste0(FOLDER,"/","2024-03-27-multiple-testing/multiple-testing-xkcd.com-882-II.png"))
```
::: notes
This xkcd cartoon illustrates the problem with multiple testing
:::

. . .

::: {.r-fit-text}
What happened? Is the conclusion sensible?
:::


<!-- ::: {.callout-note appearance="simple"} -->

<!-- ## Pay Attention -->
<!-- What happened? Is the conclusion sensible? -->


:::
. . .

## What is the probability of not rejecting null?

:::{.incremental}
- what is the probability of not rejecting the null at 0.05 significance level when testing once?

  - $1 - 0.05 = 0.95$

- what is the probability of not rejecting the null at 0.05 significance level when testing twice?

  - $(1 - 0.05)^2 = 0.95^2 = 0.9025$

- what is the probability of not rejecting the null at 0.05 significance level when testing $100$ times?

  - $(1 - 0.05)^10 = 0.95^10 = 0.0059$

:::




## How to solve multiple testing problem?


. . .

:::{.incremental}
- Bonferroni Correction

- Significance level: $\frac{0.05}{\text{# of tests}}$

- Pros and cons of using Bonferroni correction
:::

. . .

## Genome-Wide Significance Level

:::{.incremental}
- Typical level: $5 \times 10^{-8}$
- Relation to number of tests in GWAS.
:::


## Distribution of P-values Under the Null




## Simulations of P-values

- Under null and alternative hypotheses.
- Generating distribution of p-values through simulations.



## Common Approaches to Correct for Multiple Testing

- Bonferroni correction
- False Discovery Rate (FDR) control
- Family-Wise Error Rate (FWER) control



## Using qvalue Package

- Calculating q-values and controlling FDR in R.





## References

Storey, John D., and Robert Tibshirani. 2003. “Statistical Significance for Genomewide Studies.” Proceedings of the National Academy of Sciences 100 (16): 9440–45.

